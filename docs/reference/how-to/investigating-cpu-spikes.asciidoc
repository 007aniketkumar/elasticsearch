[[investigating-cpu-spikes]]
== Investigating CPU spikes

[discrete]
=== Look for high CPU consuming threads

Occasional high CPU jobs are expected, but constant high CPU usage on 
long running jobs should be investigated.  If CPU utilization on a system
with an Elasticsearch node is high then find out which Elasticsearch
threads are contributing to this by running this command:

[source,console]
--------------------------------------------------
GET _nodes/hot_threads
--------------------------------------------------

[discrete]
=== Look for long running tasks

Common high CPU causes are heavy read/write. Certain elasticsearch operations
can also be CPU intensive, like lookup, analyzer, nested aggregation, force
merge, percolate query, machine learning jobs. Some watcher jobs can also be
expansive (depends on the script)

[source,console]
--------------------------------------------------
GET _tasks?detailed
--------------------------------------------------

